<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Louis Trousse">

<title>Functionnal trait-based analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Functional_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="Functional_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="Functional_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="Functional_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Functional_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="Functional_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Functional_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Functional_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Functional_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Functional_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Functionnal trait-based analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Louis Trousse </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="description" class="level1">
<h1>Description</h1>
<p>The purpose of this work is to perform a functional analysis on a dataset containing information about the abundances of different species classified into groups based on their functional traits. This analysis is useful for comparing the functional identity of communities within one locality or another grouping factor, especially when facing a specific condition (e.g., over time, before/after a specific event, during a specific treatment, etc.).</p>
<p>This analysis is based on the work of Gomez Gras <em>et al.</em> <span class="citation" data-cites="gómez-gras2021">(<a href="#ref-gómez-gras2021" role="doc-biblioref">Gómez-Gras et al. 2021</a>)</span> which focuses on the changes in the functional identity of coralligenous assemblages in response to marine heatwaves. The approach used is also based on the work of Teixido et al. <span class="citation" data-cites="teixidó2018">(<a href="#ref-teixidó2018" role="doc-biblioref">Teixidó et al. 2018</a>)</span> on the characterization of functional biodiversity loss along natural CO<sub>2</sub> gradients. Please cite these authors if you use this work. This work reproduces and improves upon the script provided by Gomez-Gras <em>et al.</em> <span class="citation" data-cites="gómez-gras2021">(<a href="#ref-gómez-gras2021" role="doc-biblioref">Gómez-Gras et al. 2021</a>)</span> and Teixido <em>et al.</em> <span class="citation" data-cites="teixidó2018">(<a href="#ref-teixidó2018" role="doc-biblioref">Teixidó et al. 2018</a>)</span>, making it easier to use and more flexible. While all treatments are similar to those performed by the authors, they are implemented here with functions to facilitate reproduction with different datasets. The details of the functions are hidden in the principal script for readability, but all details can be found within the function script itself.</p>
</section>
<section id="principle-and-prerequisites" class="level1">
<h1>Principle and prerequisites</h1>
<section id="scripts" class="level2">
<h2 class="anchored" data-anchor-id="scripts">Scripts</h2>
<p>To conduct this functional trait-based analyis, two script containing some functions are needed :</p>
<ol type="1">
<li><p>“<strong><em>quality_funct_space</em></strong>” coded by Eva Maire &amp; Sébastien Villéger (sebastien.villeger@cnrs.fr) is an update from <span class="citation" data-cites="maire2015">(<a href="#ref-maire2015" role="doc-biblioref">Maire et al. 2015</a>)</span>. It computes the quality (i.e.&nbsp;mean squared-deviation between initial functional distance and standardized distance in the functional space) for the best functional dendrogram and all the multidimensional functional spaces from 2 to N dimensions (N selected by the user).</p></li>
<li><p>“<strong><em>functionalanalysis</em></strong>” is the main script containing all functions to compute the analysis conducted by Gomez Gras <em>et al</em>. <span class="citation" data-cites="gómez-gras2021">(<a href="#ref-gómez-gras2021" role="doc-biblioref">Gómez-Gras et al. 2021</a>)</span> .</p></li>
</ol>
<p>One additional script is provided : “<strong><em>SCRIPT_functional_analysis”</em></strong>, it is not mandatory but serves as a good base for running this analysis easily or in a”routine” manner. Following document describe what do this script. For the script to work properly, it must be in the same folder as the data file and the ones containing the functions.</p>
</section>
<section id="datasets" class="level2">
<h2 class="anchored" data-anchor-id="datasets">Datasets</h2>
<p>Three datasets are necessary for the script to function correctly:</p>
<ul>
<li><strong>Abundance_data</strong>: Contains results of species abundances.</li>
<li><strong>Functional_Entities</strong>: Contains detailled information on functional traits.</li>
<li><strong>Sample_metadata</strong>: Contains metadata for the samples, including at least three pieces of information: Quadrat, Site, and Year (or equivalent).</li>
</ul>
<p>Please note that in the provided script, all datasets are in .csv format. Feel free to change the extension to your preferred format, as long as the dataset maintains the same structure as the one previously shown. Ensure to change the script accordingly.</p>
<p>The following part describe how work this analysis and use as example datasets provided by Gomez Gras <em>et al.</em> <span class="citation" data-cites="gómez-gras2021">(<a href="#ref-gómez-gras2021" role="doc-biblioref">Gómez-Gras et al. 2021</a>)</span>. Datasets can be changed as long as they maintain the same structure. Here we review the construction of these datasets one by one.</p>
<section id="functional_entities-organisms-classification-into-functional-entities" class="level3">
<h3 class="anchored" data-anchor-id="functional_entities-organisms-classification-into-functional-entities"><strong><em>Functional_Entities</em></strong> <strong>:</strong> Organisms classification into functional entities</h3>
<p>These dataset contain information about the classification of organisms into Functional Entities (FE). This classification creates a unique code for each set of functional characteristics or traits. This code, called FE (Functional Entities), represents a group of species possessing an identical combination of categorized/ranked trait values. It is organised as follow :</p>
<table class="table">
<thead>
<tr class="header">
<th>FE</th>
<th>Species</th>
<th>Trait_1</th>
<th>Trait_2</th>
<th>Trait_3</th>
<th>Trait_4</th>
<th>Trait_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a1bb1</td>
<td>Sp_1</td>
<td>a</td>
<td>1</td>
<td>b</td>
<td>b</td>
<td>1</td>
</tr>
<tr class="even">
<td>b3aa2</td>
<td>Sp_2</td>
<td>b</td>
<td>3</td>
<td>a</td>
<td>a</td>
<td>2</td>
</tr>
<tr class="odd">
<td>a2ba1</td>
<td>Sp_3</td>
<td>a</td>
<td>2</td>
<td>b</td>
<td>a</td>
<td>1</td>
</tr>
<tr class="even">
<td>a1bb1</td>
<td>Sp_4</td>
<td>a</td>
<td>1</td>
<td>b</td>
<td>b</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>The column <strong>Species</strong> contains your species list or any other taxa unit, with one entry per taxa. Each <strong>Trait_</strong> column contains a set of letters or integers that describe possible combinations for one functional trait. Letters are used to describe nominal traits and integers are used to describe quantitative or ranked traits. The combination of all trait values for one species constitute its <strong>FE</strong> code. Note that more than one species can have the same FE code even from different groups. The script provided in this work can be used with any species and traits as needed for your purposes. To work properly, don’t change the titles of FE and Species columns</p>
<p>For example, in the data provided by Gomez Gras <em>et al.</em> <span class="citation" data-cites="gómez-gras2021">(<a href="#ref-gómez-gras2021" role="doc-biblioref">Gómez-Gras et al. 2021</a>)</span>, FE is a combination of the values associated with the following 12 functional traits:</p>
<table class="table">
<caption>For each species trait values were selected as the most accurate average description of species-specific traits. As some species show plasticity in the expression of certain traits and we were interested in global comparisons across species rather than on intraspecific variation, a fuzzy coding procedure based on coarse ranked and nominal categories was applied (Cheven <em>et al.,</em> 1994).</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Morphology</strong></td>
<td>(a) Boring, (b) Encrusting, (c) Filaments, (d) Stolonial (e) Foliose Erect, (f) Articulated, (g) Corymbose, (h) Cup-like, (i) Mass.-Encr., (j) Mass.-Erect (k) Mass. Hem. (l), Tree-like</td>
</tr>
<tr class="even">
<td><strong>Growth.rate</strong></td>
<td>(1) Extreme slow (&lt; 1cm* year<sup>-1</sup>), (2) Slow (~ 1 cm * year <sup>-1</sup>), (3) Moderate (1–5 cm * year <sup>-1</sup>), (4) High (5–10 cm * year <sup>-1</sup>), (5) Very High (&gt; 10 cm * year <sup>-1</sup>)</td>
</tr>
<tr class="odd">
<td><strong>Solitary.colonial</strong></td>
<td>(1) Solitary, (2) Colonial/Gregarious</td>
</tr>
<tr class="even">
<td><strong>Maximum.longevity</strong></td>
<td>(1) Very low (weeks), (2) Low (months; &lt; 12), (3) Medium (1–3 years), (4) High (3–20 years), (5) Very High (&gt;20 years)</td>
</tr>
<tr class="odd">
<td><strong>Height (max)</strong></td>
<td>(1) Very low (&lt; 1 cm / 1cm), (2) Low (2–5 cm), (3) Medium (5–20 cm), (4) High (20–50 cm), (5) Very High (&gt;50 cm)</td>
</tr>
<tr class="even">
<td><strong>Width (max)</strong></td>
<td>(1) Very low (&lt; 1 cm / 1cm), (2) Low (2–5 cm), (3) Medium (5–20 cm), (4) High (20–50 cm), (5) Very High (&gt;50 cm)</td>
</tr>
<tr class="odd">
<td><strong>Epibiosis :</strong></td>
<td>(1) Never, (2) Facultative, (3) Obligate</td>
</tr>
<tr class="even">
<td><strong>Energetic.ressources</strong></td>
<td>(1) Autotroph, (2) Auto-heterotroph, (3) Heterotroph</td>
</tr>
<tr class="odd">
<td><strong>Photosynthetic_pigment</strong></td>
<td>(a) None, (b) Chl a/b (e.g.&nbsp;green algae), (c) Chl a/c, Fucoxanthin, (e.g.&nbsp;brown algae), (d) Chl a, Phycocyanin, Phycoerythrin (e.g.&nbsp;red algae), (e) Chl a, Phycocy-anin (Cyanobacteria), (f) Dinoflagellathed, (g) Mix. (e.g.&nbsp;turf)</td>
</tr>
<tr class="even">
<td><strong>Feeding</strong></td>
<td>(a) Primary producer, (b) Active filter feeder w. cilia, (c) Active filter feeder by pumping, (d) Passive filter feeder, (e) Mixture, (f) Saprophytic</td>
</tr>
<tr class="odd">
<td><strong>Age.at.reproduction</strong></td>
<td>(1) Very low (weeks), (2) Low (months; &lt; 12), (3) Moderate (1–5 years), (4) High (&gt; 5 years)</td>
</tr>
<tr class="even">
<td><strong>Physicial.defences</strong></td>
<td>(a) Non-calcifier, (b) Non-calc. spicules, (c) Calc. spicules and sclerites, (d) Carbonate w. discontinuities, (f) Continuous Carbonate, (g) Mixture</td>
</tr>
</tbody>
</table>
<p>To ensure the proper functioning of the analysis, be aware of the importance of certain characters in R. For example, don’t use special characters like “/”, ““,”(“, or”)” in your column names or taxa names. Prefer using “_” or “.” instead.</p>
</section>
<section id="sample_metadata-sampling-unit-information" class="level3">
<h3 class="anchored" data-anchor-id="sample_metadata-sampling-unit-information"><strong><em>Sample_metadata</em></strong> <strong>: sampling unit information</strong></h3>
<p>This dataset contains informations about the sample design used. It is composed of at least three columns as follows (values are given as examples):</p>
<table class="table">
<thead>
<tr class="header">
<th>Quadrat</th>
<th>Site</th>
<th>Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Condition_1_Quadrat_Site_1_1</td>
<td>Site_1</td>
<td>Condition_1</td>
</tr>
<tr class="even">
<td>Condition_1_Quadrat_Site_1_2</td>
<td>Site_1</td>
<td>Condition_1</td>
</tr>
<tr class="odd">
<td>Condition_1_Quadrat_Site_2_1</td>
<td>Site_2</td>
<td>Condition_1</td>
</tr>
<tr class="even">
<td>Condition_1_Quadrat_Site_2_2</td>
<td>Site_2</td>
<td>Condition_1</td>
</tr>
<tr class="odd">
<td>Condition_2_Quadrat_Site_1_1</td>
<td>Site_1</td>
<td>Condition_2</td>
</tr>
<tr class="even">
<td>Condition_2_Quadrat_Site_1_2</td>
<td>Site_1</td>
<td>Condition_2</td>
</tr>
</tbody>
</table>
<p>The <strong>Quadrat</strong> column contains the smallest sampling unit used for sampling communities. The <strong>Site</strong> column contains the unit in which comparison is desired; it can be any other grouping factor. However, for both this column and the previous one, the names Quadrat and Site must be kept in order for the functions to run correctly. The last column, “<strong>Condition</strong>” can be replaced by any condition you may need. It represents the condition for which you want to compare your data. You can also add any other columns to this dataset to fulfill your purpose and accommodate any additional treatments you may require.</p>
</section>
<section id="abundance_data-matrix-of-abundances-of-the-different-taxa" class="level3">
<h3 class="anchored" data-anchor-id="abundance_data-matrix-of-abundances-of-the-different-taxa"><strong>Abundance_data : Matrix of abundances of the different taxa</strong></h3>
<p>This dataset contains the results of quadrat or photoquadrat characterization. It is a matrice of abundances of the different taxa of interest. This community characterization dataset has the following structure : first column contains the sampling names (which should match those in the <strong>Quadrat</strong> column of the previous dataset); columns represent identified taxandefined. Values are the abundances of each taxa in the corresponding sample unit (i.e.&nbsp;quadrat). This dataset should have the following shape :</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Sp_1</th>
<th>Sp_2</th>
<th>Sp_3</th>
<th>Sp_4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Condition_1_Quadrat_Site_1_1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Condition_1_Quadrat_Site_1_2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Condition_1_Quadrat_Site_2_1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Condition_1_Quadrat_Site_2_2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Condition_2_Quadrat_Site_1_1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Please note that the names of species should be the same as those presented in the</p>
<p><strong>Global Principle of all function</strong></p>
<p>Given a functional matrix, the function computes the quality (i.e.&nbsp;mean squared-deviation between ## ## initial functional distance and standardized distance in the functional space) for the best functional ## ## dendrogram and all the multidimensional functional spaces from 2 to N dimensions (N selected by the user). ## ## A graphical output illustrating the quality of each functional space is also provided.</p>
</section>
</section>
<section id="installation-guide" class="level2">
<h2 class="anchored" data-anchor-id="installation-guide">Installation guide</h2>
</section>
<section id="utilisation-guide" class="level2">
<h2 class="anchored" data-anchor-id="utilisation-guide">Utilisation guide</h2>
</section>
</section>
<section id="functionnal-analysis" class="level1">
<h1>Functionnal Analysis</h1>
<section id="working-environment" class="level2">
<h2 class="anchored" data-anchor-id="working-environment">Working environment</h2>
<section id="prepare-working-environment" class="level3">
<h3 class="anchored" data-anchor-id="prepare-working-environment">Prepare working environment</h3>
<p>To conduct this analysis script and files should be place in the same folder. Thus, if you are working in a R project, only the specification of this folder will be necessary at the creation of the project. Otherwise, the specification of the working directory is necessary before starting analysis.</p>
<p>Once all files and working directory specify, the installation and loading of packages usefull for the analysis is required. To do so, please use the following code (If installation needed, please uncomment corresponding lines.</p>
</section>
<section id="load-required-data" class="level3">
<h3 class="anchored" data-anchor-id="load-required-data">Load required data</h3>
<p>Once data files are placed in the right folder, they have to be charged in R environnement. To do so, please use following code :</p>
<p>Here is the detail of each document</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>Document</th>
<th>Descrition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FE_ordered.csv</td>
<td>Description of Functionnal Entities according to their trait values. Colums are variables taken into account to form FE and lines are each unique FE.</td>
</tr>
<tr class="even">
<td>Species_FE.csv</td>
<td>Classification of each species into funtional entities. This file contain two collums, one containing species name and one containing FE code associated.</td>
</tr>
<tr class="odd">
<td>Abundances.csv</td>
<td>Abundance (% cover) of each taxonomic unit found in every assemblage over the monitored location and period (replicates are photoquadrats for each combination of location and period). This file is a community matrix containing result of community caracterisation with each species in colum and each line coresponding to a replicate (i.e.&nbsp;Photoquadrat)</td>
</tr>
<tr class="even">
<td>Sites.txt</td>
<td>Metadata file containing informations about site and year for each photoquadrat. Photoquadrat names are shared between this file and the abundances one.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="create-functional-space" class="level2">
<h2 class="anchored" data-anchor-id="create-functional-space">Create Functional Space</h2>
<p>As precised by Gomez gras <em>et al</em>., 2021, based on Functional Entities a Principal Coordinate analysis (PCoA) based on a Gower dissimilarity matrix was performed to create a multidimentional trait spaces in which FEs of each assemblages and temporal point were positionned according to their differences in traits values.</p>
<p>The Gower dissimilarity index was chosen because it allows for mixed types of data (see Legendre &amp; Legendre, 2012). In their paper Four PCoA dimensions were retained in order to balance the amount of explained variation (75%), the computational times and a low mean squared-deviation index values (mSD = 0.003). The mean squared deviation is the average squared difference between the estimated values and the actual value.</p>
<p>To create functional space, a function called quality_funct_space is used. It is based on the work of Maire et al.&nbsp;2015 (Global Ecology and Biogeography). Given a functional matrix, the function computes the quality (i.e.&nbsp;mean squared-deviation between initial functional distance and standardized distance in the functional space) for the best functional dendrogram and all the multidimensional functional spaces from 2 to N dimensions (N selected by the user). A graphical output illustrating the quality of each functional space is also provided. The Code was done by Eva Maire &amp; Sébastien Villéger (sebastien.villeger@cnrs.fr). Please read the file if a better understanding is needed. <strong>To work, the code for this function must be placed in the same file.</strong></p>
<p>This function take 6 arguments :</p>
<ul>
<li><p>“mat_funct” : a species x functional traits matrix (NA are not allowed, at least 3 species and 3 traits). Traits could be of different types (e.g.&nbsp;numeric, ordinal, nominal)</p></li>
<li><p>“traits_weights” : a numeric vector (NA are not allowed) with weights for all traits in “mat_funct”, Applied only with Gower’s distance. Default is same weight for all traits</p></li>
<li><p>“nbdim” : maximum number of dimensions for multidimensional functional spaces. By default, nbdim=7. This number should be specify by user in function of his data. Final number of dimensions depends on the number of positive eigenvalues (after correction) obtained with PCoA</p></li>
<li><p>“metric” : metric to be used to compute functional distance, “Euclidean” or “Gower” (=default)</p></li>
<li><p>“dendro” : a logical value indicating whether the best functional dendrogram shoudl be looked for (default is TRUE) , Setting value to FALSE will save computation time, especially when working with &gt;100 species</p></li>
<li><p>“plot” : character string to set the name of the jpeg file for plots illustrating the quality of functional spaces (NA means no plot).</p></li>
</ul>
<p>In order to verify the quality of space, the meanSD value need to be checked. A low meanSD means a high quality of the representation ( as mean squared deviation is the average squared difference between the estimated values in a specify space and the actual value in a multiple space.</p>
<p>This value have to be minimal, but a compromise should be made, beetween the number of dimension to use and this value, as an augmentation of the number of dimension increse computational time. As an example , the dimension at which meanSD &lt; 0.004 is a good “rule of thumb” . I the following code, 4 first dimensions are conserved, but this value maybe changed to fullfill your purpose.</p>
<p>In the code above, the variance explained by PCoA axes can be seen, the 4 first explain 75 % of the variance.</p>
</section>
<section id="functional-richness-frich-and-functional-identity-fi" class="level2">
<h2 class="anchored" data-anchor-id="functional-richness-frich-and-functional-identity-fi">Functional Richness (Frich) and functional identity (FI)</h2>
<p><strong><em>Frich</em></strong> is calculated as the 4D convex hull volume of the multidimensional trait space generated for each assemblages (and temporal point)</p>
<p>To test if <strong><em>Frich</em></strong> is different between assemblages (and temporal point), A null model can be used. It allow to test whether the observed values of <strong><em>Frich</em></strong> significanthly differed from the null hypothesis that <strong><em>Frich</em></strong> remained constant between assemblages. To do so, a simulation of 9999 random assemblages for each factor : site and time point (while keeping the number of FEs constant over time on each site’s pool) can be conducted. The observed values of <strong><em>Frich</em></strong> can then be compared with the simulated random ones using a bilateral test (alpha &gt; 0.05)</p>
<p><strong><em>FI -Functional identity-</em></strong> is a unic value. It is calculated as the abundance weighted centroid of the community in the multidimensional trait space. To do so the position of each FE in the trait space is weighted by it’s abundance and then averaged in the total assemblage pool.</p>
<section id="trends-of-functional-richness-frich" class="level3">
<h3 class="anchored" data-anchor-id="trends-of-functional-richness-frich">Trends of functional richness (Frich)</h3>
<p>In this part we will draw graphics that represent the functional richness under the differents conditions (i.e.&nbsp;locations and spaces for example) To do so, we need to follow following steps :</p>
<ol type="1">
<li><p>Specify conditions</p>
<p>this step allow to precise conditions (localization and date) to draw plot in function.</p></li>
<li><p>Data Manipulation and arrangements<br>
This step allows to create a dataframe called ab.conditions for abundances per conditions, which summarise abundances data for each condition.</p></li>
<li><p>Calculate Total Richness</p>
<p>Before calculating the relative richness, the calculation of the total Richness is necessary, this value is the number of species encountere</p></li>
<li><p>Calculate convex hull</p>
<p>111 Taxonomic units in total for calculating the relative richness, but …</p></li>
<li><p>Plotting convex hull in a reduce space</p>
<p>Convex hull is the smallest convex polygon than can enclose all points of a set.</p>
<p>To plot convex hull in an elegant way, the choice of color is important. To choose these color you are free to change the following code with any color of your choice disponible in R (see this link : <a href="https://r-charts.com/colors/" class="uri">https://r-charts.com/colors/</a>). If you want to change colors just remember that you need as much colors as you have factors. In the following example ou have 15 factors, so you need 15 color specifications.</p></li>
</ol>
<p>Once you colors specifyed, the real plotting steps can begin.</p>
<p>During the Frich calculation Site and Time specific values are calculated, they are number of species (NbSp) and number of FEs (NbFEs), relative percentages of each (NbSpP,NbFEsP), and the 4D convex hull volume (Frich (Vol4D)) for each condition (Site &amp; Time). These information are present in the Fric ubset and be added to each plot</p>
<ol start="6" type="1">
<li>the next step to represent changes over time of <strong><em>Frich</em></strong> is to test for difference of FI inside each site over time. To do so each FI value can be tested in front of the null hypothesis that the abundance-weighted centroid of the community remained constant across time. To do so a nonparametric analysis of variance PERMANOVA (permutational multivariate analysis of variance) can be conducted for each site with time as a fixed factor. Here i an example of this step for one site.</li>
</ol>
<p>one other way to do same is :</p>
</section>
<section id="abundance-distribution-of-traits-and-fuctionnal-identity-fi" class="level3">
<h3 class="anchored" data-anchor-id="abundance-distribution-of-traits-and-fuctionnal-identity-fi">Abundance distribution of traits and fuctionnal identity (FI)</h3>
<p>Changes in species abundances may change the functional identity (mean values of traits) of species communities (i.e., abundance-weighted average value for each trait. Abundance weightning is important because several reason :</p>
<ul>
<li><p><strong>Reflects Actual Community Composition</strong> : Abundance-weighting ensures that the traits of more common species have a greater influence on the calculated community-level trait values. This is important because more abundant species are likely to have a greater impact on ecosystem processes and functioning compared to rare species. Without abundance weighting, the influence of rare species might be overrepresented, leading to a skewed interpretation of community traits.</p></li>
<li><p><strong>Ecological significance :</strong> Traits of abundant species are more likely to affect ecosystem functions such as productivity, nutrient cycling, and energy flow. By weighting traits by abundance, the analysis better captures the functional roles that species play in the ecosystem. For example, if a particular trait associated with resource use efficiency is prevalent in abundant species, it can indicate the overall resource use strategy of the community.</p></li>
<li><p><strong>Better inference of Ecosystem processes</strong> : Abundance-weighted trait analysis can provide insights into how ecosystems might respond to environmental changes. For example, if certain traits become more common as the environment changes (e.g., due to climate change or habitat alteration), abundance-weighted traits can help predict shifts in ecosystem processes. This can be crucial for understanding and managing ecosystems under changing conditions.</p></li>
<li><p><strong>Enhances Comparability Across Studies :</strong> Using abundance-weighted traits standardizes the way communities are compared, making it easier to relate findings across different studies and ecosystems. This comparability is important for synthesizing results and drawing broader ecological conclusions.</p></li>
</ul>
<p>However, it also mitigates the noise from rare species which can be an advantage or not depending on context. Rare species can have unusual or extreme trait values that might disproportionately influence unweighted trait analysis. But, if these rare species have unique functional trait they are succeptible to have a great influence on the community depending on interaction with other species for example.</p>

</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-gómez-gras2021" class="csl-entry" role="listitem">
Gómez-Gras, Daniel, Cristina Linares, Maria Dornelas, Joshua Madin, Viviana Brambilla, Jean-Baptiste Ledoux, Paula López-Sendino, Nathaniel Bensoussan, and Joaquim Garrabou. 2021. <span>“Climate Change Transforms the Functional Identity of Mediterranean Coralligenous Assemblages.”</span> <em>Ecology Letters</em>, March. <a href="https://doi.org/10.1111/ele.13718">https://doi.org/10.1111/ele.13718</a>.
</div>
<div id="ref-maire2015" class="csl-entry" role="listitem">
Maire, Eva, Gaël Grenouillet, Sébastien Brosse, and Sébastien Villéger. 2015. <span>“How Many Dimensions Are Needed to Accurately Assess Functional Diversity? A Pragmatic Approach for Assessing the Quality of Functional Spaces.”</span> <em>Global Ecology and Biogeography</em> 24 (6): 728–40. <a href="https://doi.org/10.1111/geb.12299">https://doi.org/10.1111/geb.12299</a>.
</div>
<div id="ref-teixidó2018" class="csl-entry" role="listitem">
Teixidó, Nuria, Maria Cristina Gambi, Valeriano Parravacini, Kristy Kroeker, Fiorenza Micheli, Sebastien Villéger, and Enric Ballesteros. 2018. <span>“Functional Biodiversity Loss Along Natural CO2 Gradients.”</span> <em>Nature Communications</em> 9 (1): 5149. <a href="https://doi.org/10.1038/s41467-018-07592-1">https://doi.org/10.1038/s41467-018-07592-1</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>